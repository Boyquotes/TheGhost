[gd_scene load_steps=10 format=3 uid="uid://cwp1ve1aktg5"]

[ext_resource type="ArrayMesh" uid="uid://b6wvq2lw2aw2x" path="res://imports/grass_straw.obj" id="1_ruwlg"]
[ext_resource type="Shader" path="res://scenes/props/floor.gdshader" id="2_fttoj"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_obb33"]

[sub_resource type="PlaneMesh" id="PlaneMesh_dmfss"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_2h2xt"]

[sub_resource type="GDScript" id="GDScript_4mpti"]
script/source = "extends Area3D

@onready var folliage : MultiMeshInstance3D = $Folliage
@onready var shader : Shader = preload(\"res://scenes/props/floor.gdshader\")
var shader_material : ShaderMaterial

var target : Vector3 = Vector3(global_position.x, 7.3, global_position.z)

func _ready():
	folliage.material_override = ShaderMaterial.new()
	folliage.material_override.shader = shader
	shader_material = folliage.material_override
	#shader_material.set_shader_parameter(\"radius\",1)

func _physics_process(delta):
	if shader_material == null:
		return
	if !get_overlapping_bodies().is_empty():
		#var player_area = get_overlapping_areas()\\
		#.filter(func(obj): return obj.is_in_group(\"Player\"))
		var bodies = get_overlapping_bodies()
		#if player_area.is_empty() :
		#	return
		#var player_location = player_area[0].location
		#if player_location == null:
		#	return
		#print(bodies[0])
		#shader_material.set_shader_parameter(\"radius\", lerpf(shader_material.get_shader_parameter(\"radius\"), 5.0, delta))
		target.x = lerpf(target.x, bodies[0].global_position.x, delta * 8)
		target.y = lerpf(target.y, bodies[0].global_position.y, delta * 2)
		target.z = lerpf(target.z, bodies[0].global_position.z, delta * 8)
	else:
		target.y = lerpf(target.y, 7.3, delta * 0.8)
		#shader_material.set_shader_parameter(\"radius\", lerpf(shader_material.get_shader_parameter(\"radius\"), 1.0, delta * 0.1))
	shader_material.set_shader_parameter(\"player_pos\", target)
	
"

[sub_resource type="BoxShape3D" id="BoxShape3D_sjdxh"]
size = Vector3(2, 1, 2)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_uvric"]
render_priority = 0
shader = ExtResource("2_fttoj")
shader_parameter/albedo = null
shader_parameter/interact_power = null
shader_parameter/player_pos = null
shader_parameter/radius = null

[sub_resource type="MultiMesh" id="MultiMesh_usqkx"]
transform_format = 1
instance_count = 59
mesh = ExtResource("1_ruwlg")
buffer = PackedFloat32Array(-3.28191, -0.0595136, 1.27273, -0.228291, -0.00208095, 3.51696, 0.159089, 0, -1.27412, 0.147553, -3.27859, -0.95611, 1.77049, -0.0916557, -3.56496, -0.9834, -0.175398, 3.97308, -0.189258, 0, 3.56182, 0.24121, 1.76273, 0.0612735, -1.58899, 0.132915, 3.49425, 0.405618, -0.115174, 3.83403, -0.198215, 0, -3.49488, -0.186782, -1.58217, -0.741533, -0.594714, 0.179469, 4.11143, 0.281064, -0.19044, 4.14848, -0.208634, 0, -4.11093, -0.218142, -0.58512, -0.851716, 0.270813, 0.082771, 3.66102, -0.209526, 0.216257, 3.66425, -0.0988409, 0, -3.65557, 0.222903, 0.26537, 0.102709, 3.84599, -0.119096, 1.16397, -0.347667, 0.0818809, 4.01674, 0.140436, 0, -1.16718, -0.110648, 3.84527, -0.507314, -2.13919, -0.190289, -3.41512, -0.537102, -0.292255, 4.02346, -0.04112, 0, 3.4079, 0.225597, -2.14725, 0.588421, -3.26664, -0.150432, -1.72175, 0.769473, -0.0318856, 3.68627, -0.261578, 0, 1.72802, -0.216356, -3.25963, -0.969748, 3.74342, 0.0370839, -2.19439, -0.717599, 0.0715109, 4.33436, 0.195239, 0, 2.19353, -0.20459, 3.73851, 0.897184, 3.52751, 0.227132, -1.99582, 0.651813, -0.17897, 4.0528, 0.144904, 0, 2.00072, -0.0379272, 3.53184, -0.201447, -2.53282, 0.167975, 2.64385, 0.18278, 0.0554302, 3.66034, -0.179454, 0, -2.6486, -0.0840282, -2.53203, 0.122756, -3.51771, 0.0412264, -2.01185, 0.520654, 0.135922, 4.04736, -0.154722, 0, 2.00768, -0.201777, -3.51455, 0.0940331, -2.52045, -0.0780828, -2.63745, 0.467304, -0.0832959, 3.6479, -0.0283968, 0, 2.6373, 0.0405914, -2.5215, -0.987445, 4.20711, -0.0875993, -0.36026, -0.569663, 0.108322, 4.2152, 0.240032, 0, 0.354581, -0.248345, 4.20117, -0.0251264, -1.89211, -0.0493521, 3.30427, 0.869381, -0.219278, 3.80104, -0.0687923, 0, -3.29735, -0.224454, -1.8915, -0.268255, -4.34342, 0.0755865, 0.967237, -0.572489, 0.0903522, 4.44916, 0.0580427, 0, -0.965969, 0.0762834, -4.34369, -0.0412664, 3.83978, -0.0745741, -2.12025, -0.159527, 0.0322712, 4.38574, -0.0958134, 0, 2.12131, 0.0682667, 3.83931, 0.944028, 3.21701, 0.129569, -3.04366, -0.927621, -0.0754286, 4.42858, 0.108801, 0, 3.04549, -0.0271824, 3.21778, 0.649, -2.68219, 0.203295, 2.26058, -0.602284, 0.217524, 3.50643, -0.0572423, 0, -2.25925, 0.0962524, -2.68927, 0.899449, -2.64614, -0.165437, -2.45712, 0.797197, -0.0725618, 3.61032, -0.164937, 0, 2.46162, -0.0714156, -2.64617, -0.705397, -4.22545, 0.115065, -0.865937, -0.0741074, 0.127779, 4.31262, -0.0504562, 0, 0.864153, -0.0750552, -4.22672, 0.0486457, -3.07103, 0.0853817, -2.05709, 0.764069, 0.158412, 3.69298, -0.0832117, 0, 2.05276, -0.157253, -3.07109, -0.548403, -2.8729, 0.0538587, -2.25004, -0.998834, 0.17787, 3.64251, -0.139918, 0, 2.24364, -0.219804, -2.87, -0.215751, -3.69748, 0.179667, -0.9147, 0.367728, 0.140605, 3.80636, 0.179284, 0, 0.921513, 0.140116, -3.69749, 0.689912, -3.35529, -0.11186, 2.62374, -0.725744, -0.0148917, 4.25769, 0.162477, 0, -2.62608, 0.118777, -3.35322, 0.781614, 1.62522, -0.218164, 3.09327, 0.631712, 0.292098, 3.48761, 0.0925056, 0, -3.08717, 0.215136, 1.63718, 0.497565, 0.334551, 0.051023, 3.84724, 0.115382, -0.119889, 3.86002, -0.0407671, 0, -3.84571, -0.115897, 0.335955, -0.638516, -0.420927, -0.0128489, 4.02649, -0.135051, -0.153626, 4.04554, -0.0031503, 0, -4.02358, -0.15312, -0.421111, 0.207189, -3.86669, -0.073141, -1.49593, 0.550084, -0.141226, 4.14102, 0.162575, 0, 1.49104, 0.202548, -3.86396, -0.696711, 4.02297, 0.0396158, 0.484287, 0.163146, -0.026384, 4.05057, -0.112174, 0, -0.485188, 0.108211, 4.0216, 0.78799, -0.0224496, 0.176831, 3.77577, 0.731609, -0.0579701, 3.77537, -0.177157, 0, -3.77946, -0.0589578, -0.0197104, 0.633151, -3.05791, -0.202403, -2.464, 0.994803, -0.062059, 3.92416, -0.245329, 0, 2.47153, -0.15189, -3.05476, 0.790713, -3.50339, -0.0897641, 1.41569, -0.219339, 0.00387952, 3.77148, 0.248738, 0, -1.41852, 0.232009, -3.4957, -0.872198, 1.27212, 0.0917472, -3.2706, 0.528878, -0.131953, 3.50769, 0.0470743, 0, 3.26922, 0.105877, 1.27455, 0.453146, -0.216602, -0.169088, -4.36974, 0.198782, -0.0675429, 4.37471, -0.165933, 0, 4.37249, 0.0592009, -0.219029, 0.00441277, -2.12744, 0.26656, 3.78307, 0.508737, 0.299694, 4.33591, -0.136978, 0, -3.78059, 0.193714, -2.1397, 0.129184, -3.87408, 0.163685, -1.20156, 0.320303, 0.0810109, 4.04824, 0.290283, 0, 1.20995, 0.25305, -3.86666, 0.661014, 3.71428, -0.260573, 2.49997, -0.276298, 0.0790323, 4.47056, 0.348547, 0, -2.51227, -0.244608, 3.70706, 0.0255402, -3.79811, -0.157651, 0.816349, -0.993714, -0.118162, 3.88111, 0.199757, 0, -0.822993, 0.170326, -3.79612, -0.424048, 3.70071, -0.14317, -0.199224, 0.179059, 0.153592, 3.70058, 0.193688, 0, 0.191304, -0.201514, 3.69841, -0.30368, -3.41894, -0.013036, 1.38432, -0.979311, 0.0328932, 3.68662, 0.115955, 0, -1.38399, 0.119823, -3.417, 0.913879, -3.64559, -0.15635, 0.954913, 0.463354, -0.156103, 3.76853, 0.0210729, 0, -0.954953, -0.0191529, -3.64888, -0.1217, -3.88156, 0.196219, -0.37191, -0.551522, 0.181577, 3.89673, 0.160826, 0, 0.379274, 0.142594, -3.88319, 0.269993, 3.07261, 0.0676042, 2.58706, 0.777519, 0.0614889, 4.01285, -0.177892, 0, -2.58722, 0.175659, 3.0682, 0.39966, 3.31301, 0.0705845, -1.16805, -0.841938, -0.0722533, 3.51284, 0.00734252, 0, 1.16795, 0.0170964, 3.31375, 0.745918, 1.0346, -0.107138, -3.37912, 0.888063, 0.105212, 3.53311, -0.0798075, 0, 3.37918, -0.0772026, 1.03707, 0.922366, 3.63856, 0.0241816, 0.707904, -0.365031, -0.045544, 3.70502, 0.10753, 0, -0.706851, -0.114247, 3.63705, 0.253251, 3.9418, -0.138709, -0.215342, 0.616309, 0.142133, 3.94712, 0.0592452, 0, 0.213098, -0.0668689, 3.9438, -0.341102, 2.15355, -0.11134, 2.92394, -0.805148, 0.00046752, 3.63051, 0.137901, 0, -2.92606, -0.0813651, 2.15201, -0.600307, 3.74252, 0.125868, 0.616351, 0.19776, -0.133336, 3.79251, 0.0351374, 0, -0.614778, -0.0563065, 3.74447, 0.618715, 3.54393, -0.126597, -1.03776, -0.924203, 0.0935801, 3.69142, -0.130743, 0, 1.04125, 0.0991176, 3.54378, -0.612194, 3.01335, -0.0356087, -1.7892, -0.97238, 0.0284679, 3.5045, -0.0218011, 0, 1.78933, 0.00421131, 3.01348, -0.979715, 4.01298, -0.181749, -1.37721, 0.852965, 0.256693, 4.23463, 0.189125, 0, 1.36523, -0.261967, 4.01264, 0.420917, 0.218623, 0.123817, -4.48559, -0.613805, 0.187678, 4.48673, 0.132996, 0, 4.48337, -0.193856, 0.213164, -0.0365342, 3.21896, -0.0200069, 2.92642, 0.205843, -0.087265, 4.34771, 0.125712, 0, -2.92519, -0.151718, 3.21656, -0.137507, -1.36575, -0.0441736, 4.16824, -0.41584, -0.0610206, 4.386, 0.0264876, 0, -4.16803, -0.0497373, -1.36621, -0.127798, 3.97295, -0.0264926, -0.417604, 0.873388, 0.0270978, 3.99483, 0.00436905, 0, 0.417565, -0.00717765, 3.97304, -0.0884472, -4.15446, 0.0405859, 0.11349, -0.00798404, 0.0338998, 4.14897, -0.242789, 0, -0.115664, -0.241761, -4.14755, -0.881981, -0.202138, -0.214188, -3.59288, -0.954737, -0.237834, 3.59147, -0.200723, 0, 3.59139, 0.225784, -0.215515, 0.244949)

[node name="Grass" type="Node3D"]

[node name="Plane" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, -3.55271e-15, 0, 1, 0, 3.55271e-15, 0, 1, 0, 0, 0)
visible = false
material_override = SubResource("StandardMaterial3D_obb33")
mesh = SubResource("PlaneMesh_dmfss")
skeleton = NodePath("")
surface_material_override/0 = SubResource("StandardMaterial3D_2h2xt")

[node name="GrassStraw" type="MeshInstance3D" parent="."]
visible = false
mesh = ExtResource("1_ruwlg")

[node name="Area3D" type="Area3D" parent="."]
collision_layer = 0
collision_mask = 11
priority = 128.0
script = SubResource("GDScript_4mpti")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="Area3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.42499, 0)
shape = SubResource("BoxShape3D_sjdxh")

[node name="Folliage" type="MultiMeshInstance3D" parent="Area3D"]
material_override = SubResource("ShaderMaterial_uvric")
multimesh = SubResource("MultiMesh_usqkx")
