[gd_scene load_steps=8 format=3 uid="uid://cwp1ve1aktg5"]

[ext_resource type="ArrayMesh" uid="uid://b6wvq2lw2aw2x" path="res://imports/grass_straw.obj" id="1_ruwlg"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_obb33"]

[sub_resource type="PlaneMesh" id="PlaneMesh_dmfss"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_2h2xt"]

[sub_resource type="GDScript" id="GDScript_4mpti"]
script/source = "extends Area3D

@onready var folliage : MultiMeshInstance3D = $Folliage
@onready var shader : Shader = preload(\"res://scenes/props/floor.gdshader\")
var shader_material : ShaderMaterial

var target : Vector3 = Vector3(0,5,0)
@onready var rng = RandomNumberGenerator.new()

func _ready():
	folliage.material_override = ShaderMaterial.new()
	folliage.material_override.shader = shader
	shader_material = folliage.material_override
	shader_material.set_shader_parameter(\"radius\",1)

func _physics_process(delta):
	if shader_material == null:
		return
	if !get_overlapping_bodies().is_empty():
		#var player_area = get_overlapping_areas()\\
		#.filter(func(obj): return obj.is_in_group(\"Player\"))
		var bodies = get_overlapping_bodies()
		#if player_area.is_empty() :
		#	return
		#var player_location = player_area[0].location
		#if player_location == null:
		#	return
		print(bodies[0])
		shader_material.set_shader_parameter(\"radius\", lerpf(shader_material.get_shader_parameter(\"radius\"), 5.0, delta * 2.0))
		target.x = lerpf(target.x, bodies[0].global_position.x, delta * 16)
		target.y = lerpf(target.y, bodies[0].global_position.y, delta * 16)
		target.z = lerpf(target.z, bodies[0].global_position.z, delta * 16)
	else:
		target.y = lerpf(target.y, 7, delta * 2)
	shader_material.set_shader_parameter(\"player_pos\", target)
	shader_material.set_shader_parameter(\"radius\", lerpf(shader_material.get_shader_parameter(\"radius\"), 1.0, delta * 0.1))
"

[sub_resource type="BoxShape3D" id="BoxShape3D_sjdxh"]
size = Vector3(3, 1, 3)

[sub_resource type="MultiMesh" id="MultiMesh_5emyy"]
transform_format = 1
instance_count = 50
mesh = ExtResource("1_ruwlg")
buffer = PackedFloat32Array(-4.32743, -0.490259, -1.82471, -0.906387, -0.55083, 4.68946, 0.046378, 0, 1.80735, 0.255363, -4.35486, -0.173511, 2.07833, 0.0111117, 2.66593, -0.772794, -0.0801025, 3.37905, 0.0483629, 0, -2.66475, -0.092908, 2.07779, -0.0184094, -1.09071, 0.382157, -3.01483, -0.506646, 0.414276, 3.19193, 0.254728, 0, 3.01059, -0.300777, -1.1273, -0.0489054, -3.2748, -1.00568, -0.407667, -0.223457, -1.07224, 3.19822, 0.7236, 0, 0.166989, 0.813575, -3.34845, 0.728732, 2.46188, 0.278888, 4.02231, 0.486817, 0.923776, 4.54846, -0.880771, 0, -3.92472, 1.24553, 2.31579, -0.626982, -3.59558, 0.650792, -0.86794, -0.0925199, 0.658329, 3.69725, 0.0450069, 0, 0.862237, -0.109052, -3.65373, 0.00799429, -3.16433, 0.904224, -2.87996, 0.0627427, 0.977596, 4.25449, 0.261659, 0, 2.85589, -0.454465, -3.28057, -0.629325, 0.296436, -1.15928, 4.26476, -0.628337, 0.109526, 4.27496, 1.15444, 0, -4.41816, 0.0281938, 0.314763, 0.924442, 0.766513, -0.0731322, -4.00918, 0.967906, -0.364233, 4.06363, -0.143763, 0, 3.99327, 0.384688, 0.756454, -0.614622, 2.69599, 0.510425, 3.06062, 0.248892, -0.74661, 4.0421, -0.0164469, 0, -3.01173, -0.545126, 2.74384, 0.398662, 2.90451, -0.491681, -1.84304, 0.139176, 0.809642, 3.35778, 0.380164, 0, 1.72715, -0.747191, 2.9212, -0.0134315, 3.78618, -0.416079, 1.89734, -0.736112, 0.0554201, 4.17805, 0.805636, 0, -1.94164, -0.692097, 3.7228, 0.284602, 2.8549, 0.591218, 3.21417, -0.962168, -0.0608889, 4.27675, -0.732585, 0, -3.26753, 0.436863, 2.82194, 0.439861, -1.27971, 0.540651, -3.49939, 0.240324, 0.888414, 3.65092, 0.239173, 0, 3.42764, -0.744432, -1.36849, 0.636069, 2.60276, 0.233643, -2.89144, -0.384698, 0.0650584, 3.87901, 0.372006, 0, 2.90014, -0.296703, 2.58661, 0.872409, 2.28455, -0.992524, -3.00706, -0.651665, -0.0930858, 3.68529, -1.28711, 0, 3.16525, 0.824743, 2.13252, -0.862614, -2.40758, -1.23749, 3.26474, 0.225206, -1.1697, 4.02241, 0.662088, 0, -3.28963, -0.524573, -2.62478, -0.631549, -3.58288, -0.0628267, -2.39455, -0.384224, 0.0982061, 4.30089, -0.259787, 0, 2.39336, -0.27053, -3.574, -0.311854, -1.37598, 0.218834, -3.86922, -0.545411, -0.464135, 4.06701, 0.395078, 0, 3.84751, 0.568876, -1.33608, 0.44966, -1.48292, -1.11918, 4.09818, 0.20097, -1.66516, 4.14647, 0.529829, 0, -3.90831, -1.34199, -1.7807, 0.112867, -1.97069, -0.615621, 2.64933, -0.215751, -0.0536521, 3.2798, 0.722213, 0, -2.71939, 0.38142, -1.93417, 0.264606, -1.51725, 1.3251, 3.99745, 0.459573, 0.0449528, 4.25383, -1.39302, 0, -4.21112, -0.432019, -1.45514, 0.0718124, 1.90453, 0.995734, 2.66768, -0.161587, -0.510083, 3.27678, -0.858924, 0, -2.8014, 0.0803077, 1.97002, 0.541503, 0.0392861, 0.331275, 3.63808, -0.314453, 0.372687, 3.61894, -0.333557, 0, -3.63407, 0.374716, 0.00512202, 0.878369, 4.00442, -0.141759, -2.62893, 0.239469, -0.268277, 4.73854, -0.664157, 0, 2.61905, 0.702127, 3.95151, -0.604568, 2.93451, -0.735221, 0.826176, 0.336865, 0.723805, 3.04803, 0.141576, 0, -0.836196, 0.0582058, 3.02189, 0.109907, -1.77512, -0.62412, -2.77369, -0.347655, -0.732782, 3.25991, -0.264555, 0, 2.74699, 0.466297, -1.86296, -0.767078, 1.48766, -1.05051, 3.90903, -0.763173, -0.327119, 4.11986, 1.23166, 0, -4.03449, -0.721399, 1.34153, 0.797318, 3.31447, 0.38026, 2.90229, 0.239475, 0.513461, 4.24095, -1.14204, 0, -2.88171, 1.19302, 3.13465, 0.882476, -4.39106, 0.460248, 0.306501, -0.1948, 0.440702, 4.3945, -0.285188, 0, -0.333995, -0.252433, -4.40589, 0.284811, -0.430811, 0.202056, -3.23479, 0.114279, 0.28991, 3.25256, 0.164556, 0, 3.2281, -0.265141, -0.446482, -0.711438, 2.3082, -0.109627, -2.71521, 0.766009, 0.0482966, 3.5636, -0.102824, 0, 2.717, 0.0297869, 2.30851, -0.318415, -0.138709, -0.942118, 4.1285, 0.427814, -1.04877, 4.00967, 0.879764, 0, -4.1027, -0.993133, -0.364474, -0.946433, 4.58602, -0.925447, -0.707365, 0.132933, 0.695988, 4.48112, -1.3504, 0, 0.934033, 1.20479, 4.47934, -0.447377, 2.65055, -0.853831, 1.85645, -0.928139, 0.928193, 3.21189, 0.152002, 0, -1.82041, 0.394487, 2.78053, 0.304214, 4.31493, -0.563579, 2.22526, 0.804148, 0.706129, 4.83409, -0.144931, 0, -2.18422, 0.449448, 4.34916, -0.543416, -3.02017, 0.430988, 3.73042, 0.478681, 0.893862, 4.73212, 0.176959, 0, -3.6473, 0.80284, -3.04563, 0.900822, 1.26502, 0.852513, 2.84113, -0.719031, 0.101304, 3.07449, -0.967641, 0, -2.96455, 0.468842, 1.17929, -0.499556, -1.76535, 0.810618, -2.60562, 0.81857, -0.260905, 3.03898, 1.1222, 0, 2.7163, 0.818725, -1.58562, 0.511233, -0.110596, 1.09929, 3.86317, -0.965905, 1.10763, 3.72313, -1.02773, 0, -3.86079, 1.03665, -0.405514, -0.279534, -3.93116, 0.00146129, -2.86939, 0.71982, 0.100269, 4.86407, -0.134895, 0, 2.86764, -0.168072, -3.92885, -0.0684508, -3.29509, 0.524732, 0.374673, -0.257333, 0.512398, 3.31543, -0.136943, 0, -0.391371, -0.0772152, -3.3338, -0.189839, 3.32986, -1.13541, 1.1537, -0.414898, 1.13189, 3.51968, 0.196974, 0, -1.15715, 0.175551, 3.51259, 0.38662, -3.16439, -0.886263, -0.553789, -0.206817, -0.758006, 3.16213, -0.729263, 0, 0.719424, -0.566512, -3.20421, -0.630391, -3.65364, 1.07051, -0.622025, 0.217987, 1.09178, 3.69971, -0.0456576, 0, 0.583879, -0.219284, -3.80696, 0.794448, -4.79732, 0.275224, -0.361966, 0.729656, 0.268646, 4.81035, 0.0970897, 0, 0.366875, 0.0764771, -4.80423, -0.605544, 2.01897, 1.40914, 3.86562, -0.43825, 0.0262453, 4.30145, -1.58172, 0, -4.11437, 0.718921, 1.88682, -0.889982, -3.29921, 1.01489, -1.40987, -0.342035, 0.974099, 3.58641, 0.302197, 0, 1.43836, -0.100934, -3.43853, -0.338252, 2.02024, 0.996023, 2.65018, -0.221493, -0.0489418, 3.26752, -1.19073, 0, -2.83074, 0.654347, 1.91196, -0.160207, 3.20116, 0.615029, -0.376912, 0.710947, -0.63972, 3.21281, -0.190691, 0, 0.33329, 0.259506, 3.25412, 0.121179)

[node name="Grass" type="Node3D"]

[node name="Plane" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, -3.55271e-15, 0, 1, 0, 3.55271e-15, 0, 1, 0, 0, 0)
visible = false
material_override = SubResource("StandardMaterial3D_obb33")
mesh = SubResource("PlaneMesh_dmfss")
skeleton = NodePath("")
surface_material_override/0 = SubResource("StandardMaterial3D_2h2xt")

[node name="GrassStraw" type="MeshInstance3D" parent="."]
visible = false
mesh = ExtResource("1_ruwlg")

[node name="Area3D" type="Area3D" parent="."]
collision_layer = 0
collision_mask = 11
priority = 128.0
script = SubResource("GDScript_4mpti")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="Area3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.42499, 0)
shape = SubResource("BoxShape3D_sjdxh")

[node name="Folliage" type="MultiMeshInstance3D" parent="Area3D"]
multimesh = SubResource("MultiMesh_5emyy")
