[gd_scene load_steps=11 format=3 uid="uid://bfan743wneoqh"]

[ext_resource type="PackedScene" uid="uid://1cinutwv1t3l" path="res://scenes/props/floor.tscn" id="1_qn23l"]
[ext_resource type="PackedScene" uid="uid://c5v2jrbwtfkpk" path="res://scenes/player/player.tscn" id="3_5fsbt"]
[ext_resource type="PackedScene" uid="uid://nwfp3m8cudyt" path="res://scenes/npcs/furnance/core.tscn" id="3_24p4y"]
[ext_resource type="PackedScene" uid="uid://bq8q4xxajkmv0" path="res://scenes/maze.tscn" id="6_k2kex"]
[ext_resource type="PackedScene" uid="uid://bqo3tjtuvfrpx" path="res://scenes/props/elevator.tscn" id="10_cgyns"]

[sub_resource type="NavigationMesh" id="NavigationMesh_cqbhm"]
vertices = PackedVector3Array(-23.4, 0.63909, -30.3, -30.3, 0.63909, -30.3, -30.3, 0.63909, -23.4, -23.4, 0.63909, -30.3, -30.3, 0.63909, -23.4, -30.3, 0.63909, -16.5, -16.4, 0.63909, -30.3, -23.4, 0.63909, -30.3, -30.3, 0.63909, -16.5, -30.3, 0.63909, -9.6, -4.2, 0.63909, -4.2, -3.2, 0.63909, -4.7, -2.4, 0.63909, -30.3, -9.4, 0.63909, -30.3, -30.3, 0.63909, -2.6, -4.8, 0.63909, -2.5, -4.8, 0.63909, -3.1, -3.2, 0.63909, -4.7, -2.4, 0.63909, -4.7, -2.4, 0.63909, -30.3, -30.3, 0.63909, -2.6, -4.8, 0.63909, -3.1, -4.2, 0.63909, -4.2, -9.4, 0.63909, -30.3, -16.4, 0.63909, -30.3, -30.3, 0.63909, -9.6, -2.4, 0.63909, -4.7, 2.3, 0.63909, -4.7, 2.3, 0.63909, -30.3, -2.4, 0.63909, -30.3, 30.3, 0.63909, -23.3, 30.3, 0.63909, -30.3, 23.3, 0.63909, -30.3, 30.3, 0.63909, -16.3, 30.3, 0.63909, -23.3, 23.3, 0.63909, -30.3, 30.3, 0.63909, -16.3, 23.3, 0.63909, -30.3, 16.3, 0.63909, -30.3, 30.3, 0.63909, -9.3, 4.1, 0.63909, -4.2, 4.7, 0.63909, -3.1, 30.3, 0.63909, -2.3, 30.3, 0.63909, -9.3, 16.3, 0.63909, -30.3, 9.3, 0.63909, -30.3, 4.7, 0.63909, -3.1, 4.7, 0.63909, -2.3, 30.3, 0.63909, -2.3, 2.3, 0.63909, -30.3, 2.3, 0.63909, -4.7, 3.1, 0.63909, -4.7, 2.3, 0.63909, -30.3, 3.1, 0.63909, -4.7, 4.1, 0.63909, -4.2, 9.3, 0.63909, -30.3, -30.3, 0.63909, 2.7, -4.8, 0.63909, 2.6, -4.8, 0.63909, -2.5, -30.3, 0.63909, -2.6, 4.7, 0.63909, 2.4, 30.3, 0.63909, 2.4, 30.3, 0.63909, -2.3, 4.7, 0.63909, -2.3, 3.1, 0.63909, 4.8, 1.9, 0.63909, 4.8, 1.4, 0.63909, 5.7, 4.1, 0.63909, 4.3, 3.1, 0.63909, 4.8, 1.4, 0.63909, 5.7, 0, 0.63909, 30.3, 7.5, 0.63909, 30.3, 22.7, 0.63909, 30.3, 30.3, 0.63909, 30.3, 30.3, 0.63909, 23.3, 22.7, 0.63909, 30.3, 30.3, 0.63909, 23.3, 30.3, 0.63909, 16.3, 15.1, 0.63909, 30.3, 22.7, 0.63909, 30.3, 30.3, 0.63909, 16.3, 30.3, 0.63909, 9.3, 1.4, 0.63909, 5.7, 0, 0.63909, 6.3, 0, 0.63909, 30.3, 30.3, 0.63909, 2.4, 4.7, 0.63909, 3.2, 4.1, 0.63909, 4.3, 7.5, 0.63909, 30.3, 15.1, 0.63909, 30.3, 30.3, 0.63909, 9.3, 30.3, 0.63909, 2.4, 4.7, 0.63909, 2.4, 4.7, 0.63909, 3.2, -1.5, 0.63909, 5.7, -1.9, 0.63909, 4.8, -3.2, 0.63909, 4.8, -1.5, 0.63909, 5.7, -3.2, 0.63909, 4.8, -4.2, 0.63909, 4.3, -30.3, 0.63909, 23.4, -30.3, 0.63909, 30.3, -22.8, 0.63909, 30.3, -30.3, 0.63909, 16.5, -30.3, 0.63909, 23.4, -22.8, 0.63909, 30.3, -30.3, 0.63909, 16.5, -22.8, 0.63909, 30.3, -15.2, 0.63909, 30.3, -30.3, 0.63909, 9.6, 0, 0.63909, 30.3, 0, 0.63909, 6.3, -1.5, 0.63909, 5.7, -7.6, 0.63909, 30.3, -7.6, 0.63909, 30.3, -1.5, 0.63909, 5.7, -4.2, 0.63909, 4.3, -30.3, 0.63909, 2.7, -30.3, 0.63909, 9.6, -15.2, 0.63909, 30.3, -4.8, 0.63909, 3.2, -4.8, 0.63909, 2.6, -30.3, 0.63909, 2.7, -4.2, 0.63909, 4.3, -4.8, 0.63909, 3.2, -30.3, 0.63909, 2.7)
polygons = [PackedInt32Array(2, 1, 0), PackedInt32Array(5, 4, 3), PackedInt32Array(7, 6, 8), PackedInt32Array(8, 6, 9), PackedInt32Array(11, 10, 12), PackedInt32Array(12, 10, 13), PackedInt32Array(14, 16, 15), PackedInt32Array(19, 18, 17), PackedInt32Array(21, 20, 22), PackedInt32Array(22, 20, 25), PackedInt32Array(22, 25, 24), PackedInt32Array(22, 24, 23), PackedInt32Array(29, 28, 26), PackedInt32Array(26, 28, 27), PackedInt32Array(32, 31, 30), PackedInt32Array(35, 34, 33), PackedInt32Array(37, 36, 38), PackedInt32Array(38, 36, 39), PackedInt32Array(41, 40, 42), PackedInt32Array(42, 40, 43), PackedInt32Array(43, 40, 44), PackedInt32Array(44, 40, 45), PackedInt32Array(48, 47, 46), PackedInt32Array(51, 50, 49), PackedInt32Array(53, 52, 54), PackedInt32Array(54, 52, 55), PackedInt32Array(57, 56, 58), PackedInt32Array(58, 56, 59), PackedInt32Array(63, 62, 60), PackedInt32Array(60, 62, 61), PackedInt32Array(66, 65, 64), PackedInt32Array(68, 67, 69), PackedInt32Array(69, 67, 70), PackedInt32Array(70, 67, 71), PackedInt32Array(74, 73, 72), PackedInt32Array(77, 76, 75), PackedInt32Array(79, 78, 80), PackedInt32Array(80, 78, 81), PackedInt32Array(84, 83, 82), PackedInt32Array(86, 85, 87), PackedInt32Array(87, 85, 90), PackedInt32Array(87, 90, 89), PackedInt32Array(87, 89, 88), PackedInt32Array(93, 92, 91), PackedInt32Array(96, 95, 94), PackedInt32Array(99, 98, 97), PackedInt32Array(102, 101, 100), PackedInt32Array(105, 104, 103), PackedInt32Array(107, 106, 108), PackedInt32Array(108, 106, 109), PackedInt32Array(111, 110, 112), PackedInt32Array(112, 110, 113), PackedInt32Array(115, 114, 116), PackedInt32Array(116, 114, 119), PackedInt32Array(116, 119, 118), PackedInt32Array(116, 118, 117), PackedInt32Array(122, 121, 120), PackedInt32Array(123, 125, 124)]
cell_size = 0.1
cell_height = 0.1
agent_height = 4.0
agent_radius = 1.7

[sub_resource type="FogMaterial" id="FogMaterial_oswsl"]
density = 1.6
albedo = Color(0, 1, 0, 1)
emission = Color(0.0392157, 0.0196078, 0.113725, 1)
edge_fade = 5.768

[sub_resource type="FogMaterial" id="FogMaterial_2sf1i"]
density = 2.0
albedo = Color(0, 1, 0, 1)
emission = Color(0.0392157, 0.0196078, 0.113725, 1)
edge_fade = 5.768

[sub_resource type="GDScript" id="GDScript_g2q0a"]
script/source = "extends Area3D

var map = {}

func _on_body_entered(body : RigidBody3D):
	if !map.has(body.name) :
		map[body.name] = 1
		
	if map[body.name] < 2 :
		body.global_position = Vector3(body.global_position.x, 15.0, body.global_position.z)
		map[body.name]+=1
		
	elif map[body.name] == 2 :
		map[body.name] = 0
		if body.is_in_group(\"PlayerBody\"):
			body.ik()
			return
		body.freeze = true
		body.sleeping = true
		body.global_position = body.INITIAL_POSITION
		body.freeze = false
		body.sleeping = false
"

[sub_resource type="BoxShape3D" id="BoxShape3D_f6hwb"]
size = Vector3(1000, 2, 1000)

[node name="Base Level" type="Node3D"]

[node name="FurnancePlane" type="NavigationRegion3D" parent="."]
navigation_mesh = SubResource("NavigationMesh_cqbhm")

[node name="Floor" parent="FurnancePlane" instance=ExtResource("1_qn23l")]

[node name="Furnance" parent="FurnancePlane" instance=ExtResource("3_24p4y")]

[node name="FogVolume" type="FogVolume" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 112.018, 31.5217)
size = Vector3(200, 40, 200)
material = SubResource("FogMaterial_oswsl")

[node name="FogVolume2" type="FogVolume" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -145.725, 0)
size = Vector3(200, 60, 200)
material = SubResource("FogMaterial_2sf1i")

[node name="Player" parent="." instance=ExtResource("3_5fsbt")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 30, -46, 20)

[node name="DeathArea" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -146.763, 0)
collision_layer = 15
collision_mask = 15
script = SubResource("GDScript_g2q0a")

[node name="CollisionShape3D" type="CollisionShape3D" parent="DeathArea"]
shape = SubResource("BoxShape3D_f6hwb")

[node name="Elevator" parent="." instance=ExtResource("10_cgyns")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 28, -0.3, 36)
current_dir = "down"

[node name="Maze" parent="." instance=ExtResource("6_k2kex")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -48, 0)

[connection signal="body_entered" from="DeathArea" to="DeathArea" method="_on_body_entered"]
